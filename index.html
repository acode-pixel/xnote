<!--TODO remove doc folder-->
<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="//code.iconify.design/1/1.0.6/iconify.min.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello Bulma!</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css">
    <!--<link rel="stylesheet" href="./style.css" type="text/css">!-->
  </head>
  <body>

    <nav class="navbar is-flex-mobile" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">
        <h1 class="navbar-item">Xnote</h1>
        <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample" onclick="menu(this)">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </a>
      </div>
    
      <div id="navbarBasicExample" class="navbar-menu">
        <div class="navbar-start">
          <a class="navbar-item is-active" href="/">
            Home
          </a>
    
          <a class="navbar-item" href="/Doc.html">
            Documentation
          </a>
    
          <div class="navbar-item has-dropdown is-hoverable">
            <a class="navbar-link">
              More
            </a>
    
            <div class="navbar-dropdown">
              <a class="navbar-item">
                About
              </a>
              <a class="navbar-item">
                Jobs
              </a>
              <a class="navbar-item">
                Contact
              </a>
              <hr class="navbar-divider">
              <a class="navbar-item">
                Report an issue
              </a>
            </div>
          </div>
        </div>
    
        <div class="navbar-end">
          <div class="navbar-item">
            <div class="buttons">
              <a class="button is-link">
                <strong>Sign up</strong>
              </a>
              <a class="button is-light">
                Log in
              </a>
            </div>
          </div>
        </div>
      </div>
    </nav>

  <section class="section">
    <section class="section">
      <div class="container">
        <h1 class="title">
          Untitled Folder
          <button class="button js-modal-trigger" onclick="$('#change-title').toggleClass('is-active')" id="addFolder">
            <span class="iconify mdi icon mdi-24px" data-icon="mdi-plus-box-multiple"></span>
          </button>
        </h1>
        <hr>
        <button class="button is-link is-outlined" id="addNote">
          <span class="iconify mdi icon-text" data-icon="mdi-plus"></span>
          Add Note
        </button>
      </div>
      <div class="modal" id="change-title">
        <div class="modal-background"></div>
        <div class="modal-card">
          <header class="modal-card-head">
            <p class="modal-card-title">Folder title</p>
            <button class="delete" aria-label="close" onclick="$('#change-title').toggleClass('is-active')"></button>
          </header>
          <section class="modal-card-body">
            <input class="input" type="text" placeholder="Folder Title" id="title" maxlength="12">
            <article class="message is-danger" id="invalid-title-msg">
              <div class="message-body">
                Avoid using any special characters or spaces in the title and try again.
              </div>
            </article>
          </section>
          <footer class="modal-card-foot">
            <div class="buttons">
              <button class="button is-success is-outlined" onclick="button(this)" id="saveTitle">Save changes</button>
              <button class="button" onclick="$('#change-title').toggleClass('is-active')">Cancel</button>
            </div>
          </footer>
        </div>
      </div>
    </section>
  
    <section class="section">
      <div class="container">
        <div class="columns">
          <div class="column is-one-third">
            <div class="card">
              <header class="card-header">
                <p class="card-header-title">Component</p>
              </header>
              <div class="card-content">
                <div class="content">
                  Test
                </div>
              </div>
            </div>
          </div>
          <div class="column is-one-third">
            <div class="card">
              <header class="card-header">
                <p class="card-header-title">Component</p>
              </header>
              <div class="card-content">
                <div class="content">
                  Test
                </div>
              </div>
            </div>
          </div>
          <div class="column is-one-third">
            <div class="card">
              <header class="card-header">
                <p class="card-header-title">Component</p>
              </header>
              <div class="card-content">
                <div class="content">
                  Test
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </section>

  <section class="section">
    <section class="section">
      <div class="container">
        <h1 class="title">
          Untitled Folder
          <button class="button" onclick="button(this)" id="addFolder">
            <span class="iconify mdi icon mdi-24px" data-icon="mdi-plus-box-multiple"></span>
          </button>
        </h1>
        <hr>
        <button class="button is-link is-outlined" onclick="button(this)" id="addNote">
          <span class="iconify mdi icon-text" data-icon="mdi-plus"></span>
          Add Note
        </button>
      </div>
    </section>
  
    <section class="section">
      <div class="container">
        <div class="columns">
          <div class="column is-one-third">
            <div class="card">
              <header class="card-header">
                <p class="card-header-title">Component</p>
              </header>
              <div class="card-content">
                <div class="content">
                  Test
                </div>
              </div>
            </div>
          </div>
          <div class="column is-one-third">
            <div class="card">
              <header class="card-header">
                <p class="card-header-title">Component</p>
              </header>
              <div class="card-content">
                <div class="content">
                  Test
                </div>
              </div>
            </div>
          </div>
          <div class="column is-one-third">
            <div class="card">
              <header class="card-header">
                <p class="card-header-title">Component</p>
              </header>
              <div class="card-content">
                <div class="content">
                  Test
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </section>

  <!--<footer class="footer">
    <div class="content has-text-centered">
      <p>
        <strong>Xnote</strong> by <a href="https://github.com/acode-pixel">acode-pixel</a>.
      </p>
    </div>
  </footer>!-->

  </body>
  <div class="section is-flex-mobile" id="notif-area" style="font-size: 125%; flex-direction: column-reverse; margin-right: -10px; z-index: 31; position: fixed; top: -30px; right: 1px;"></div>

  <script>
    $("#invalid-title-msg").slideToggle();

    function close_noti(element){
      $(element).parent().fadeOut();
      setTimeout(function (){
        $(element).parent().remove();
      }, 1000);
    }

    function success_parser(){
      $('#notif-area').append('<div class="notification is-success"><button class="delete" onclick="close_noti(this)"></button>Operation Completed   <span class="iconify mdi mdi-24px" data-icon="mdi-check-circle"></span></div>');
    }

    function error_parser(){
      $('#notif-area').append('<div class="notification is-danger"><button class="delete" onclick="close_noti(this)"></button>Operation Failed   <span class="iconify mdi mdi-24px" data-icon="mdi-close-circle"></span></div>');
    }

    function update(data, status, xhr){
      data = JSON.parse(xhr.responseText);
      if(data.hasUpdate){
        $('#notif-area').append('<div class="notification is-success"><button class="delete" onclick="close_noti(this)"></button>Update Completed   <span class="iconify mdi mdi-24px" data-icon="mdi-check-circle"></span></div>');
      };
      console.log(data);
    }

    $.get("command", {cmd: "update"}, update);

    $.ajaxSetup({success: success_parser, error: error_parser});

    function button(element){
      $(element).toggleClass("is-loading");
      $(element).toggleClass("is-outlined");

      if($(element).attr("id") == "addNote"){
        $.get("command", {cmd: "create"});
      } else if($(element).attr("id") == "saveTitle"){
        var iname = document.getElementById("title").value;
        let regex = /[^0-9A-Z]/i;
        if(!regex.test(iname)){
          $.get("command", {cmd: "create_folder", title: iname});
          $("#change-title").toggleClass("is-active");
          $("#invalid-title-msg").slideUp();
        } else {
          $("#invalid-title-msg").slideDown();
        }
      }

      $(element).toggleClass("is-loading");
      $(element).toggleClass("is-outlined");
      setTimeout(function(){$.get("command", {cmd: "update"}, update)}, 200);
    }

    function menu(burger){
      var menu = document.getElementById("navbarBasicExample");
      $(menu).fadeToggle(function(){
        menu.style.removeProperty("display");
      });
      $(menu).toggleClass("is-active");
      $(burger).toggleClass("is-active");
    }
  </script>
</html>